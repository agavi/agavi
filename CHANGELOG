AGAVI CHANGELOG
===============

1.0.1 RC1 (March ??, 2009)
--------------------------

FIX: Regression: changes to extra parameters in AgaviRoutingCallback::onGenerate() have no effect (#1057) (Dominik)
FIX: Regression: extra parameters added by AgaviRoutingCallback::onGenerate() are not added to routing string as e.g. query params (#1056) (Dominik)
FIX: Execution filter may run into fatal error if no caching rules are defined for an output type, and the action is cached (#1055) (David)


1.0.0 (February 25, 2009)
-------------------------

ADD: Project configuration system's public-create should ask for the environment to bootstrap (#1053) (David)

CHG: AgaviReturnArrayConfigHandler should throw exception if config file is not in legacy 0.11 XML namespace (#1054) (David)

FIX: Project configuration system script does not accept multiple property definitions (#1052) (Noah)


1.0.0 RC2 (February 23, 2009)
-----------------------------

ADD: Allow passing of an explicit Validation Report object to Form Population Filter (#1050) (David)

CHG: Improve best practices in generated projects (#1049) (David, Noah)
CHG: Make route patterns mandatory again (#1047) (David)

FIX: Regression: routing callbacks cannot modify options (#1051) (David)
FIX: Default View code template sets wrong title attribute (#1048) (David)


1.0.0 RC1 (February 16, 2009)
-----------------------------

ADD: Add AgaviArrayPathDefintion::flatten() method (#1042) (Dominik)

CHG: Make route patterns optional (#1046) (David)
CHG: Update timezone database to 2009b (#1043) (David)
CHG: Regex validator should export the validated data (#1041) (Felix)
CHG: Add workaround for PHP bug 47206 (#1038) (David)

FIX: AgaviTranslationManager::$translators and $supplementalData are not initialized as empty array (#1045) (David)
FIX: Certain libxml versions cause some config handlers to randomly produce invalid results due to corrupt XPath result sets (#1039) (David)
FIX: Regression: empty arguments that weren't validated remain in request data (#1044) (David)
FIX: Identity template in _common.xsl performs verbatim copies of elements (#1040) (David)
FIX: Regression: AgaviSoapController::dispatch() signature is incompatible with that of AgaviController::dispatch() (#1037) (David)
FIX: Regression: Sample App SOAP, XMLRPC and Console interfaces are broken (#1036) (David)


1.0.0 beta9 (February 10, 2009)
-------------------------------

ADD: Allow setting of session_cache_expire(), session_cache_limiter() and session_module_name() through configuration (#1035) (David)
ADD: Implement a basic system for testing Agavi applications and internal components, THIS IS EXPERIMENTAL! (#1021) (Felix, David)
ADD: Introduce special AgaviUncacheableException for cache group callbacks (#1032) (David)
ADD: Implement new validation report query API (#1022) (Dominik, David)
ADD: Allow routing callbacks to return an AgaviResponse (#1028) (David)

CHG: Rename "messageIndex" in AgaviValidationError to "name" (#1030) (David)
CHG: Explicitly call onNotMatched() method on a routing callback if its onMatched() method returned false (#1027) (David)
CHG: Restore state right after a routing callback returned false from onMatched() rather than at the end of the callback execution loop (#1026) (David)
CHG: Throw exception if Apache's SERVER_SOFTWARE env var contains insufficient version information (#1029) (David)

FIX: Regression: Fatal error in AgaviRouting with use_translation off (#1031) (David)
FIX: Regression: Locale and Request Method are not restored to previous value after a matching route's callback(s) caused the match to ultimately fail (#1024) (David)
FIX: Regression: invalid Locale or Output Type names in routes trigger premature exceptions (#1023) (David)
FIX: Use of undefined variable $request in AgaviWebRouting::execute() (#1025) (David)


1.0.0 beta8 (February 4, 2009)
------------------------------

SEC: CVE-2009-0417: Cross-site scripting vulnerability in handling of incoming URLs (#1019) (David)

ADD: AgaviController::dispatch() should accept an AgaviExecutionContainer as optional second argument (#1012) (David)
ADD: Allow relative min and max values using strtotime syntax in AgaviDateTimeValidator (#1018) (Dominik)
ADD: Support for arbitrary HTTP POST Content Types (#1015) (David)
ADD: Automatically decode HTTP PUT payload into request parameters for application/x-www-form-urlencoded Content-Type in AgaviWebRequest (#1016) (David)
ADD: Support for anti-stampede callbacks in Execution Filter (#744) (David)
ADD: AgaviResponse::hasContent() (#1007) (David)
ADD: Complete support for multiple SOAP services in the same application (#1001) (David)
ADD: AgaviException::render() should send shell exit code (#990) (David)
ADD: Command line support (request/response/routing) (#480) (David)
ADD: Optionally set 'secure' flag on response cookies automatically (#982) (David)
ADD: Optionally set 'secure' flag on session cookies automatically (#981) (David)
ADD: Add AgaviWebRequest::isHttps() convenience method (#980) (David)
ADD: Allow setting of session save path in AgaviSessionStorage (#979) (David)

CHG: Throw named error if "required" condition is not satisfied in validators (#1020) (Dominik)
CHG: Add extension points to XML schema definitions where feasible (#515) (David, Noah)
CHG: Change configuration system to support only XML (#519) (David, Noah)
CHG: AgaviTimezone::createCustomTimeZone() should throw exceptions for unparseable TZ strings (#958) (David)
CHG: Rewrite Routing (#448) (Dominik, David, Felix)
CHG: Make populating of module and action names into request data configurable and remove overwriting behavior (#812) (David)
CHG: Polish the Sample App (#998) (David)
CHG: Update timezone database to 2009a (#1013) (David)
CHG: Steamline date formatting and parsing behaviors when using timezones (#964) (Dominik, David, Felix)
CHG: Rename AgaviTranslationManager::getCurrentTimeZone() to getDefaultTimeZone() (#994) (David)
CHG: Remove unused property AgaviOperatorValidator::$errors (#987) (David)
CHG: Allow arbitrary number of fractional seconds for parsing date formats (#977) (Dominik)

FIX: Content-Type and Content-Length request headers are treated incorrectly (#1017) (David)
FIX: AgaviWebRequest HTTP PUT support ignores Content-Type header (#1014) (David)
FIX: Project configuration system does not reflect user-specified template extension in configuration (#1003) (Noah)
FIX: Project configuration system does not copy all templates according to user-specified extension (#1002) (Noah)
FIX: Several date classes are lacking type hints in method signatures (#997) (Dominik)
FIX: FPF does not insert error messages or classes for submit buttons (#1011) (David)
FIX: Shiny exception template produces invalid XHTML (#1009) (David)
FIX: Sample App's and code templates' SecureSuccessView responds with a 401 HTTP status code instead of 403 (#1010) (David)
FIX: [EXPLETIVE] Fucking Debian fucking ruined their fucking PHP package once again, and now we need to waste fucking time to fucking fix it (#1008)
FIX: AgaviSoapController does not handle some SoapServer/SoapClient options properly (#1006) (David)
FIX: Marshalling of document/literal wrapped SOAP responses is broken (#1004) (David)
FIX: Infinite loop is infinite (#1000) (David)
FIX: Default compile.xml and Sample app's Disabled module module.xml are still in old configuration format (#999) (David)
FIX: AgaviCalendar::setTimeInMillis() doesn't explicitly cast value to float (#996) (David)
FIX: Build system does not always identify modules correctly (#924) (Noah)
FIX: The AgaviDateTimeValidator doesn't check input value types for unix and unix_milliseconds formats
FIX: AgaviConfigCache::loadConfigHandlers() may trigger "cannot redeclare class" fatal error (#989) (David)
FIX: Caching generates invalid group values in some cases (#988) (David)
FIX: Validation marks fields that weren't processed due to unsatisfied dependencies as sucessful (#984) (Dominik, David)
FIX: Form Population Filter reveals errors from validators with severities "silent" and "info" (#986) (David)
FIX: Validators with argument arrays might not perform dependency checks (#985) (David, Dominik)
FIX: AgaviValidationErrror::__construct() does not check type of arguments (#983) (Dominik)
FIX: The Milliseconds 1-99 are missing the leading 0 when a date is formatted (#978) (Dominik)
FIX: Module setting values are not literalized (#976) (David)


1.0.0 beta7 (January 11, 2009)
------------------------------

ADD: AgaviDateTimeValidator should accept input as UnixTimestamp and as TimeInMillis (#974) (Dominik)
ADD: Add option to control Propel 1.3 instance pooling (#960) (Felix)
ADD: AgaviArraylengthValidator (#948) (Dominik)
ADD: Allow optional marshalling of document/literal wrapped request and response elements (#940) (Felix, David)

CHG: Harden path string handling in AgaviArrayPathDefinition (#973) (David, Dominik)
CHG: Change magic_quotes_gpc handling to require PHP 5.2.8 and use the fixes introduced there (#953) (David)
CHG: Rename AgaviException::printStackTrace() (#949) (David)
CHG: Re-throw exception instead of printing stack trace and info in exception templates when display_errors is off (#952) (David)
CHG: Refactor AgaviConfigCache::callHandler() to be more modular and testable (#929) (Felix)
CHG: Refactor AgaviToolkit::stringBase() (#935) (Felix)
CHG: Add configuration file path to header comments in compiled files if possible (#938) (David)
CHG: Add +FollowSymLinks to .htaccess code templates and samples (#893) (David)

FIX: Init queries are not run correctly for Propel 1.3 (#975) (David)
FIX: AgaviWebResponse sends Content-Length header with value 0 even if 'send_redirect_content' option is enabled (#972) (David)
FIX: Using the timezone option in a locale string passed to _d() can possibly change the timezone of the given calendar object (#962) (Dominik)
FIX: AgaviValidationValidatorResult missing from autoload.xml (#969) (Veikko)
FIX: Caching does not support customized view name schemes (#970) (David)
FIX: AgaviTranslationManager::createCalendar() forgets TZ offset when called with DateTime object (#957) (Dominik)
FIX: Missing variable declaration in AgaviGettextTranslator (#968) (Dominik)
FIX: AgaviWebRequestDataHolder method implementations are all over the place (#955) (David)
FIX: Request data is not cleared if default View is run in absence of suitable Action::execute*() method (#967) (David)
FIX: Slot container created inside a forward container retains "is_forward" parameter (#966) (David)
FIX: AgaviValidationManager::getFailedFields() calls invalid method (#963) (Dominik)
FIX: Access to global request data holder is not locked during AgaviAction::getDefaultViewName() (#954) (David)
FIX: The class name of AgaviAndoperatorValidator and AgaviNotoperatorValidator don't match the coding guidelines (#951) (David)
FIX: Several validators might raise notices or break altogether on incorrect argument types (#946) (Dominik)
FIX: AgaviValidator::getKeysInCurrentBase triggers a warning if the current validator base is no array (#947) (Dominik)
FIX: FPF error insertion fails if XPath expression yields more than one location in the document (#943) (David)
FIX: Arguments are unable to be named in validators configuration (#942) (Noah)
FIX: Possible to run any action by passing module/action parameters to invalid URL (#934) (David)
FIX: Pattern delimiter is not passed to several preg_quote calls (#939) (David)
FIX: Off-by-one error in AgaviToolkit::stringBase() (#936) (Felix)
FIX: AgaviPropelDatabase::connect() doesn't honor datasource parameter (#937) (David, Sven Kretschmann)
FIX: AgaviConfigCache::getCacheName() possibly creating ambiguous cache names (#932) (Felix)
FIX: AgaviConfigCache::getCacheName() path escaping problems (#931) (Felix)
FIX: Invalid CSS in project wizard's WelcomeSuccess template (#928) (TANAKA Koichi, David)
FIX: Converting an AgaviCalendar with a custom unnamed Timezone an DateTime object fails (#922) (Dominik)


1.0.0 beta6 (November 12, 2008)
-------------------------------

ADD: Optionally allow sending of response content when redirecting in AgaviWebResponse (#916) (David)

CHG: Assume "strict" validation mode directly inside AgaviValidationManager in addition to code templates and remove "conditional" default for development environments (#919) (David)
CHG: Add more best practices to code templates (#910) (David)
CHG: Use standard layouts etc for system actions instead of hand-built renderers and layers in code templates (#911) (David)
CHG: Always merge slot response metadata even if response content is null (#917) (David)
CHG: Update timezone database to 2008i (#912) (David)
CHG: Add standard warning about broken libxml versions (#909) (David)
CHG: Update timezone database to 2008h (#896) (David)

FIX: logging.xml and output_types.xml handlers have variable name escaping problems (#921) (David)
FIX: AgaviXmlConfigParser::transformProcessingInstructions() is broken completely (#918) (David)
FIX: Wrong urls when passing host and port to WebRouting::gen() (#902) (Felix)
FIX: build.xml is missing reset of code templates dir to default before copying dist.htaccess (#914) (David)
FIX: Filename patterns are escaped incorrectly in config_handlers.xml (#913) (Noah)
FIX: Build system fails to find or generate default action (#899) (Noah)
FIX: Config handlers definition loading sequence may cause exceptions with debug mode off (#905) (Dominik)
FIX: Less aggressive inclusion of per module config handlers, they are only loaded at first module initialization (#906) (Felix)
FIX: Regression: xml:base attributes left behind by XIncludes cause config validations to fail (#895) (Noah)
FIX: Regression: nested XIncludes cause segfaults in PHP 5.2.5 and lower (#894) (Noah)
FIX: Build system output is unreadable in Windows PowerShell (#891) (Noah)
FIX: AgaviSoapResponse::searchSoapHeader() compares namespaces incorrectly (#892) (David)
FIX: Calling AgaviValidationReport::getSucceededArguments() on virgin report object causes "Invalid argument supplied for foreach()" warning (#890) (David)


1.0.0 beta5 (October 20, 2008)
------------------------------

ADD: Allow for a fallback directory for template resolution in the project configuration system (#876) (Noah)

FIX: Validator config handler might produce undefined variable notices and subsequent errors with nested validators (#888) (David)
FIX: AgaviDatabase::getName() always returns false (#887) (David)
FIX: Validation config handler is broken for nested validators (#886) (David)


1.0.0 beta4 (October 19, 2008)
------------------------------

ADD: Add support for new validation configs to build system and introduce best practices (#882) (David)
ADD: Allow specifying of doctrine template implementations (#864) (David, TANAKA Koichi)

CHG: Clean up the Phing components of the project configuration system (#875) (Noah)
CHG: Change Form Population Filter to use validation system's ability to more accurately handle different sources of input (#786) (David)
CHG: Validation system needs to be able to tell two fields of same names, but from different sources, apart (#785) (Dominik)
CHG: Update logging.xml in Sample app and code templates and add "log" dir to Sample app (#879) (David)
CHG: Change singular/plural handling in AgaviXmlConfigDomElement convenience methods (#878) (David)

FIX: Build system output is unreadable in Terminal.app on Mac OS X Leopard (#885) (David)
FIX: Project configuration system depends on Phing >= 2.3.0, but should depend on >= 2.3.1 (#884) (Noah)
FIX: Build system does not create app/log folder in new projects (#881) (David, Noah)
FIX: Parameters are not merged in config_handlers.xml (#880) (David)
FIX: XInclude failure leads to corrupt exception error message (#877) (David)
FIX: Configuration files with old-style handlers are never validated (#870) (David)
FIX: Default autoload.xml is missing AgaviMysqliDatabase entry (#868) (David)
FIX: Per-module config_handlers.xml will cause "unsupported operand types" fatal error with debug mode off (#867) (David)
FIX: SOAP and XMLRPC test scripts in sample app are broken (#866) (David)
FIX: AgaviXmlConfigDomElement::hasChild() does not pass on $namespaceUri argument (#865) (David)
FIX: Certain validator names will cause a fatal error (#863) (David)


1.0.0 beta3 (September 21, 2008)
--------------------------------

ADD: Build system support for per-module config_handlers.xml (#855) (Noah)
ADD: Build system support for models in subdirectories (#851) (Noah)
ADD: Support for cache group callbacks (#854) (David)
ADD: Allow runtime configuration of Smarty via parameters in AgaviSmartyRenderer (#846) (David, TANAKA Koichi)
ADD: AgaviTidyFilter (#845) (David)
ADD: Allow convenience array index access in AgaviAttributeHolder (#843) (David)
ADD: Caching group element with array value support (#809) (David)
ADD: Allow customization of the way Actions, Views etc. are laid out in the filesystem (#668) (David)
ADD: AgaviXmlConfigDomElement::hasAgaviParameters() (#841) (David)

CHG: Update zoneinfo database to 2008f (#860) (David)
CHG: Improve sample app SearchEngineSpamAction to use ID and optionally name (#859) (David)
CHG: Factor out creation of frequently used classes from factories.xml to separate method (#857) (David)
CHG: Update ISO Schematron to latest release (#844) (Noah)
CHG: AgaviSmartyRenderer should not set a Smarty plugins dir (#848) (David)
CHG: Redesign module.xml completely to allow arbitrary settings (#834) (David)

FIX: Sample app SearchEngineSpamAction works with invalid product names (#861) (David)
FIX: Regression in AgaviXmlConfigDomElement::getAgaviParameters() (#856) (Noah)
FIX: XML namespace declarations are not carried over when transforming or merging configs (#853) (David)
FIX: AgaviXmlConfigParser does not copy <configurations> attributes when merging Agavi config files (#852) (David)
FIX: RELAX NG list definitions for "context" and "environment" attributes of <configuration> element allow only one value (#850) (David)
FIX: AgaviXmlrpcepiphpResponse::setHttpStatusCode() is not implemented but gets called in sample app Error404SuccessView (#849) (David)
FIX: System actions' templates are always copied to the first module (#805) (Noah)
FIX: Empty redirect in response may cause uninitialized string offset notice (#847) (David)
FIX: AgaviParameterHolder::removeParameter() does not try literal key lookup first (#842) (David)
FIX: module.xml must not be per-context (#839) (David)
FIX: AgaviXmlConfigDomElement::getIterator() uses incorrect XPath expressions (#840) (David)
FIX: AgaviXmlConfigXsltProcessor::transformToDoc() does not throw exceptions on runtime warnings (#837) (David)
FIX: AgaviXmlConfigXsltProcessor::transformToDoc() does not check parent return value (#836) (David)
FIX: Undefined variable notice when file for requested action does not exist (#835) (Felix)


1.0.0 beta2 (August 31, 2008)
-----------------------------

ADD: Add config option to run arbitrary SQL commands after connecting to a database (#646) (David)
ADD: Allow per-module config_handlers.xml (#826) (Felix)
ADD: Allow action-style subdirectory dot notation for models (#631) (Felix)
ADD: Allow ignoring of (X)HTML parse errors in FPF (#613) (David)
ADD: Allow skipping of template auto-assigns (#605) (David)
ADD: Set current Context instance on Doctrine connections (#800, #808) (David)

CHG: Sanity checks in AgaviExecutionContainer::set*Name() need refactoring (#780) (Felix)
CHG: Throw out legacy naming schemes support and support autoloading of Actions, Views and Models (#829) (Felix)
CHG: Add module initialization method and use it where appropriate (#825) (Felix)
CHG: Do not remove module autoload definitions after action execution (#824) (Felix)
CHG: Refactor AgaviExecutionContainer::execute, AgaviController::dispatch and AgaviSecurityFilter::dispatch to have forwards in separate methods (#827) (Felix)
CHG: Improve AgaviInflector performance (#823) (Thomas Bachem, David)
CHG: Change the Pricefinder Model in the Sample App to have a more useful name (#819) (Felix)
CHG: Make AgaviContext implementation configurable (#815) (David)
CHG: Enhance HTTP status code validation for AgaviWebResponse::setRedirect() (#804) (David)

FIX: AgaviEqualsValidator's docs do not match the actual validation process (#833) (Dominik)
FIX: Invalid argument name in AgaviValidationManager::hasError() (#832) (David)
FIX: Phing 2.2.0 is a dependency, but 2.3.0 is required for new build system (#828) (David)
FIX: The gettext translator doesn't interpret the plural forms like the original gettext implementation (#821) (Dominik)
FIX: AgaviView::initialize() incorrectly assigns container's response to a property (#813) (David)
FIX: Some config handlers use PHP-5.3-reserved-word "NAMESPACE" as constant (#810) (David, Benjamin BÃ¶rngen-Schmidt)
FIX: src/config/xsl/routing.xsl is missing (#811) (David)


1.0.0 beta1 (August 10, 2008)
-----------------------------

ADD: Implement Schematron support (#761) (David, Noah)
ADD: XSL Transformations done by XML Config Parser should have some information available in template parameters (#710) (David, Noah)
ADD: Add extension points to XML schema definitions where feasible (#515) (David, Noah)
ADD: Update SOAP support to make use of functionality introduced in #710 (#795) (David)
ADD: Allow additional types for second argument of AgaviLoggerManager::log() (#634) (David)
ADD: AgaviMysqliDatabase (#601) (Blake Matheny, David)

CHG: Move XML validation to RelaxNG and Schematron (#462) (Noah, David)
CHG: Change configuration system to support only XML (#519) (David, Noah)
CHG: Change default for assigning of "inner" content to $slots template array to disabled (#794) (David)
CHG: Rewrite the project build system and throw out the old one (#689) (Noah)
CHG: Refactor internal "system action" handling and fowarding (#769) (David)
CHG: Bump minimum required PHP version to 5.2.0 (#738) (David)
CHG: Remove direct association of validator instances and request methods (#767) (David)
CHG: Make request method per-container (#667) (David)
CHG: Deprecate core.use_routing in favor of a routing config parameter (#683) (David)
CHG: Moved AgaviWebRequest::getSourceValue() to AgaviRequest (#686) (David)
CHG: Deprecated AgaviSecureWebRequest (#676) (David)
CHG: Deprecated AgaviAdodbDatabase (#662) (David)

FIX: Security filters cannot perform checks in addition to isSecure() (#671) (David)

